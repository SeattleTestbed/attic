"""
  This program runs as a client that sends a message 
  to a server using the reliable_sendmess function from 
  the reliable library.  This client tests the library for 
  user-defined configurations.  It checks 0 retries for no retransmits 
  and no TimeoutError and a timeoutinms delay before returning from reliable_sendmess.
  
  It prints an affirmative message if everything went correctly.  
  Otherwise it prints the error that occurred.
  
  This program must be started after the server program is started.


  Arguments needed:
	serverip - the dot-decimal notation ip address of the server
	port - the port number of the server computer

"""



include reliable.repy


if callfunc == 'initialize':

  #check that there's only the arguments for the ip and port
  if len(callargs) != 2 :
    print 'Wrong number of call args used.  The test could not be run.'
    return

  #get the ip and port number
  serverip = callargs[0]
  port = int(callargs[1])

  #make message contents to send
  packet1 = 'pack 1'
 
  try:
    
    #set configurations
    max_dgram_size = 30
    max_retries = 0
    max_timeout = 20
    reliable_config(max_dgram_size, max_retries, max_timeout)

    #get the starting time of the test
    start_time = getruntime()
    print 'Start time: '+str(start_time)

    #send the message with function from library
    reliable_sendmess(serverip, port, packet1)

    #get the time when the sendmess function returns
    end_time = getruntime()
    print 'Time after reliable_sendmess returns: '+str(end_time)
 
  except TimeoutError, e:

    print 'Test failed.  A timeout error was thrown.'
    return
  
  #get the time it took to send the message
  diff_time = 1000*(end_time - start_time)
  print 'Time taken for the method in ms: '+str(diff_time)
  

  if (int)diff_time != 20 :
    print 'Test failed.  reliable_sendmess did not wait 20 ms before returning.'
    return

  print 'test completed'